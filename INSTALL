Installing HLVM
===============

Dependencies
------------

. libsigsegv >=2.5.
. LLVM sources >=2.4.
. OCaml >=3.10.2.


Installation
------------

Apply the llvm-patch.txt file to the LLVM sources in order to provide bindings for build_insertvalue and build_extractvalue and to enable tail calls globally in LLVM. Then configure LLVM with:

$ ./configure --with-ocaml-libdir=`ocamlc -where`

WARNING: If you are using Ubuntu then you may need to disable GCC's stack smashing tests by passing gcc the -fno-stack-protector flag. The stack smashing checks seem to conflict with libsigsegv's handling of stack overflows.

Then make LLVM:

$ make

Then install LLVM:

$ sudo make install


HLVM may be compiled using the script:

$ ./compile.sh

This creates an "hlvm" executable that, when run, incrementally JIT compiles and benchmarks a series of tests.

Debug mode may be enabled with:

$ ./hlvm --debug

in which case extensive information is printed to the console describing the process of compilation (which is ideal for debugging when LLVM calls abort due to a type error in the generated code) and also from print statements injected into the generated code itself (e.g. to describe what the GC is doing as it runs).

-- Jon Harrop <jon@ffconsultancy.com>
